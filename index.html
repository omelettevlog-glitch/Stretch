<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿èƒœæ‹‰ä¼¸æŒ‘æˆ˜</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #e8f5e9; /* æµ…ç»¿è‰²èƒŒæ™¯ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 30px;
            width: 100%;
            max-width: 450px;
            text-align: center;
        }
        .user-info {
            background: #f1f8e9;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #2e7d32;
        }
        .streak-badge {
            font-size: 14px;
            color: #ff9800;
            margin-top: 5px;
        }
        .timer { font-size: 70px; font-weight: bold; color: #4caf50; margin: 15px 0; }
        .exercise-title { font-size: 24px; font-weight: bold; color: #1565c0; margin-bottom: 10px; }
        .instructions { text-align: left; background: #fafafa; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 15px; }
        .controls button { background-color: #4caf50; color: white; border: none; padding: 12px 30px; font-size: 18px; border-radius: 25px; cursor: pointer; margin: 5px; }
        .controls button.reset { background-color: #9e9e9e; }
        .progress { margin-top: 15px; font-size: 14px; color: #616161; }
    </style>
</head>
<body>

<div class="container" id="app">
    <div class="user-info" id="userInfo">
        æ¬¢è¿å›æ¥ï¼Œ<span id="userNameDisplay">æœ‹å‹</span>ï¼
        <div class="streak-badge">ğŸ”¥ å½“å‰è¿èƒœï¼š<span id="streakCount">0</span> å¤©</div>
    </div>

    <div class="status" id="statusText" style="color: #666;">å‡†å¤‡å¼€å§‹ä»Šå¤©çš„æŒ‘æˆ˜å—ï¼Ÿ</div>
    <div class="exercise-title" id="exerciseTitle">æ¯æ—¥æ‹‰ä¼¸</div>
    <div class="timer" id="timerDisplay">00</div>
    
    <div class="instructions" id="instructionsDiv">
        <ul id="instructionsList" style="list-style: none; padding: 0;">
            <li>å®Œæˆå…¨éƒ¨åŠ¨ä½œå³å¯ä¿æŒè¿èƒœï¼</li>
        </ul>
    </div>
    
    <div class="controls">
        <button id="startBtn" onclick="toggleTimer()">å¼€å§‹è¿åŠ¨</button>
        <button class="reset" onclick="resetTimer()">é‡ç½®</button>
    </div>
    
    <div class="progress" id="progressText">è¿›åº¦: 0 / 5</div>
</div>

<audio id="beepSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

<script>
    // --- ç™»å½•ä¸è¿èƒœé€»è¾‘ ---
    let userName = localStorage.getItem('stretch_user');
    let streak = parseInt(localStorage.getItem('stretch_streak')) || 0;
    let lastDate = localStorage.getItem('stretch_last_date'); // æ ¼å¼: YYYY-MM-DD

    // å¦‚æœæ²¡ç™»å½•è¿‡ï¼Œå¼¹å‡ºè¯¢é—®
    if (!userName) {
        userName = prompt("æ¬¢è¿æ¥åˆ°æ‹‰ä¼¸æŒ‘æˆ˜ï¼è¯·è¾“å…¥ä½ çš„æ˜µç§°ï¼š") || "è¿åŠ¨å¥å°†";
        localStorage.setItem('stretch_user', userName);
    }
    document.getElementById('userNameDisplay').textContent = userName;

    // æ£€æŸ¥è¿èƒœæ˜¯å¦ä¸­æ–­
    const today = new Date().toISOString().split('T')[0];
    if (lastDate) {
        const last = new Date(lastDate);
        const current = new Date(today);
        const diffTime = Math.abs(current - last);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays > 1) {
            streak = 0; // è¶…è¿‡ä¸€å¤©æ²¡ç»ƒï¼Œå½’é›¶
            localStorage.setItem('stretch_streak', 0);
        }
    }
    document.getElementById('streakCount').textContent = streak;

    // --- è®¡æ—¶å™¨é€»è¾‘ ---
    const exercises = [
        { title: "1. å…¨èº«ä¼¸å±•", steps: ["åŒæ‰‹é«˜ä¸¾", "æ„Ÿè§‰è„Šæ¤æ‹‰é•¿"] },
        { title: "2. éª¨ç›†å‰å€¾ä¼¸å±•", steps: ["åŒæ‰‹å‰è…°", "æŒºèƒ¸æŠ¬å¤´"] },
        { title: "3. è‡€éƒ¨æ‹‰ä¼¸", steps: ["åå§¿å¼¯æ›²", "æ„Ÿå—è‡€éƒ¨æ‹‰ä¼¸"] },
        { title: "4. çŒ«ç‰›å¼", steps: ["å‘¼æ°”æ‹±èƒŒ", "å¸æ°”æ²‰è…°"] },
        { title: "5. å¢™å£æŠ¬è…¿", steps: ["è…¿é å¢™", "å½»åº•æ”¾æ¾"] }
    ];

    const WORK_TIME = 35;
    const REST_TIME = 10;
    let currentIdx = 0;
    let timeLeft = WORK_TIME;
    let isWorking = true;
    let isRunning = false;
    let timerInterval = null;
    const beep = document.getElementById('beepSound');

    function updateDisplay() {
        if (currentIdx >= exercises.length) {
            handleComplete();
            return;
        }
        document.getElementById('timerDisplay').textContent = timeLeft;
        if (isWorking) {
            document.getElementById('statusText').textContent = "æ­£åœ¨è¿›è¡Œä¸­...";
            document.getElementById('exerciseTitle').textContent = exercises[currentIdx].title;
            document.getElementById('instructionsList').innerHTML = exercises[currentIdx].steps.map(s => `<li>â€¢ ${s}</li>`).join('');
        } else {
            document.getElementById('statusText').textContent = "ä¼‘æ¯æ—¶é—´";
            document.getElementById('exerciseTitle').textContent = "æ·±å‘¼å¸...";
        }
        document.getElementById('progressText').textContent = `è¿›åº¦: ${currentIdx + 1} / 5`;
    }

    function handleComplete() {
        clearInterval(timerInterval);
        document.getElementById('statusText').textContent = "ğŸ‰ æŒ‘æˆ˜æˆåŠŸï¼";
        document.getElementById('timerDisplay').textContent = "Done";
        
        // ç­¾åˆ°é€»è¾‘
        if (lastDate !== today) {
            streak += 1;
            localStorage.setItem('stretch_streak', streak);
            localStorage.setItem('stretch_last_date', today);
            document.getElementById('streakCount').textContent = streak;
            alert("ç­¾åˆ°æˆåŠŸï¼è¿èƒœ +1ï¼æ˜å¤©ä¹Ÿè¦åšæŒå“¦ï¼");
        } else {
            alert("ä»Šå¤©å·²ç»ç»ƒè¿‡äº†ï¼ŒçœŸæ£’ï¼ä¿æŒçŠ¶æ€ï¼");
        }
    }

    function timerTick() {
        timeLeft--;
        if (timeLeft < 0) {
            beep.play();
            if (isWorking) {
                isWorking = false;
                timeLeft = REST_TIME;
                currentIdx++;
            } else {
                isWorking = true;
                timeLeft = WORK_TIME;
            }
        }
        updateDisplay();
    }

    function toggleTimer() {
        if (!isRunning) {
            beep.play(); beep.pause();
            timerInterval = setInterval(timerTick, 1000);
            document.getElementById('startBtn').textContent = "æš‚åœ";
        } else {
            clearInterval(timerInterval);
            document.getElementById('startBtn').textContent = "ç»§ç»­";
        }
        isRunning = !isRunning;
    }

    function resetTimer() { location.reload(); }
</script>
</body>
</html>

